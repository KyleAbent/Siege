--Kyle 'Avoca' Abent



if Server then
------------------------------------------------------------
local ontg = ARC.OnTag 
    function ARC:OnTag(tagName)
     ontg(self, tagName) 
         if tagName == "deploy_start" then
               if (   GetIsInSiege(self) and not GetTimer():GetSiegeOpenBoolean() ) then
                self:Kill() 
               end
        end
     end
------------------------------------------------------------
    function ARC:OnOrderComplete(currentOrder)     
       if (GetIsInSiege(self) and not GetTimer():GetSiegeOpenBoolean() ) then
            self:Kill() 
       end
    end
------------------------------------------------------------
    function MAC:OnOrderComplete(currentOrder)
       if (   GetIsInSiege(self) and not GetTimer():GetSiegeOpenBoolean() ) then
         self:Kill() 
        end 
        ///hmm??
                    if self.autoReturning then
                self.leashedPosition = nil
               self.autoReturning = false
            end
    end
------------------------------------------------------------
    local constorig = ConstructMixin.OnConstructionComplete
    function ConstructMixin:OnConstructionComplete(builder)
      constorig(self, builder)
         if (  GetIsInSiege(self) and not GetTimer():GetSiegeOpenBoolean() ) then
        self:Kill() 
         end 
    end    
------------------------------------------------------------
    function TeleportMixin:OnTeleportEnd(shift)
    end
------------------------------------------------------------
    local origtp = TeleportMixin.OnTeleportEnd
    function TeleportMixin:OnTeleportEnd(shift)
    origtp (self, shift)
       if (  GetIsInSiege(self)  and not GetTimer():GetSiegeOpenBoolean() ) then
        self:Kill()
       end 
    end
    /*
    local contorig = Contamination.OnInitialized
    function Contamination:OnInitialized()
      contorig(self)
              if (  GetIsInSiege(self)  and not GetTimer():GetSiegeOpenBoolean() ) then
                   self:Kill()
             end 
    end    
    */
------------------------------------------------------------
    local drifterorig = Drifter.OnInitialized
    function Drifter:OnInitialized()
      drifterorig(self)
          if (  GetIsInSiege(self)  and not GetTimer():GetSiegeOpenBoolean() ) then
            self:Kill()
         end 
    end    
------------------------------------------------------------
    local eggorig = Egg.OnInitialized
    function Egg:OnInitialized()
      eggorig(self)
              if (  GetIsInSiege(self)  and not GetTimer():GetSiegeOpenBoolean() ) then
            self:Kill()
             end 
    end    
------------------------------------------------------------
    local tunnelorig = TunnelEntrance.OnInitialized
    function TunnelEntrance:OnInitialized()
      tunnelorig(self)
              if (  GetIsInSiege(self)  and not GetTimer():GetSiegeOpenBoolean() ) then
            self:Kill()
             end 
    end   
------------------------------------------------------------ 
end // Server   

function PathingMixin:CheckTarget(endPoint)

    // if we don't have a cursor, or the targetPoint differs, create a new path
    if self.cursor == nil or (self.targetPoint - endPoint):GetLengthXZ() > 0.1 then
    
        // our current cursor is invalid or pointing to another endpoint, so build a new one
        self.points = GeneratePath(self:GetOrigin(), endPoint, false, 0.5, 2, self:GetIsFlying())
        if self.points == nil then
        
            // Can't reach the endPoint.
            return false
            
        end
        self.targetPoint = endPoint
        // the list of points does not include our current origin. Simplify the remaining code
        // by adding our origin to the list of points
        Pathing.InsertPoint( self.points, 1, self:GetOrigin() )
        
        self.cursor = PathCursor():Init(self.points)
        
    end    
    local trace = Shared.TraceRay(self:GetOrigin(),  endPoint, CollisionRep.Move, PhysicsMask.Movement, EntityFilterAllButIsa("SiegeDoor") )                                                                                                                                                                                                                                                                            
      if trace.entity ~= nil and trace.entity:GetIsLocked() then 
        return false
     end
  
  return true
    
end
---------------------------
//Shell, Spur, Veil, and Drifter limits. Why? because without these, alien commanders like to exploit and spawn billions of these.